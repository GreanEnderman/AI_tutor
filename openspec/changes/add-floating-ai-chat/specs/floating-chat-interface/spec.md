# 悬浮AI对话界面规范

## 功能概述

在base页面右下角提供悬浮AI对话入口，支持上下文感知的智能对话功能，为用户提供便捷的AI辅导体验。

## ADDED Requirements

### Requirement: 悬浮球基础显示
系统MUST在base页面右下角显示一个圆形悬浮按钮，支持用户快速访问AI对话功能。

#### 场景：用户访问base页面时悬浮球正常显示
- **当** 用户打开base页面
- **且** 页面加载完成
- **则** 页面右下角应显示悬浮球
- **且** 悬浮球显示为圆形按钮，带有AI对话图标
- **且** 悬浮球位置固定，不随页面滚动移动

### Requirement: 悬浮球交互状态
系统MUST为悬浮球提供多种交互状态和视觉反馈，提供良好的用户体验。

#### 场景：用户与悬浮球交互时的状态变化
- **当** 用户将鼠标悬停在悬浮球上
- **则** 悬浮球应放大并显示增强的阴影效果
- **当** 用户点击悬浮球时
- **则** 悬浮球应缩小提供反馈
- **当** 对话窗口关闭但有新消息时
- **则** 悬浮球应显示提示标记

### Requirement: 对话小窗基础功能
系统MUST支持点击悬浮球打开AI对话小窗，提供完整的对话功能，无需切换页面。

#### 场景：用户打开对话小窗进行AI对话
- **当** 用户点击页面右下角的悬浮球
- **则** 对话小窗应从右下角向上滑出动画显示
- **且** 小窗应包含AI对话所需的完整界面元素
- **且** 悬浮球在小窗打开期间应自动隐藏

### Requirement: 对话小窗交互功能
系统MUST支持对话小窗的拖拽、调整大小和最小化等交互功能，提供灵活的使用体验。

#### 场景：用户调整对话小窗的位置和大小
- **当** 用户拖拽小窗标题栏
- **则** 小窗应跟随鼠标移动
- **当** 用户拖拽小窗右下角
- **则** 应能调整小窗大小
- **当** 用户点击最小化按钮
- **则** 小窗应最小化为小图标
- **当** 拖拽小窗到屏幕边缘时
- **则** 应自动调整位置保持可见

### Requirement: 页面内容读取
系统MUST支持AI读取并分析当前页面内容，为对话提供上下文，提供更精准的服务。

#### 场景：AI读取笔记内容进行对话
- **当** 用户打开一篇笔记进行阅读
- **且** 用户点击悬浮球打开AI对话
- **则** AI应能够识别当前正在阅读笔记
- **且** AI应能读取笔记的完整内容作为对话上下文

### Requirement: 智能推荐提问
系统MUST根据当前页面内容和视图类型，提供智能化的推荐提问，降低用户输入成本。

#### 场景：根据视图类型提供相应的推荐问题
- **当** 用户在笔记编辑视图中打开AI对话
- **则** 推荐区域应显示"优化一下笔记排版"、"帮我写成一篇会议纪要"等问题
- **当** 用户点击推荐问题
- **则** 问题应自动填入输入框并发送
- **当** 切换到笔记阅读视图后
- **则** 推荐问题应相应更新为总结类问题

### Requirement: 基础对话能力
系统MUST确保悬浮小窗中的AI对话功能与主界面保持一致，提供完整的AI辅导体验。

#### 场景：用户在小窗中进行完整对话
- **当** 用户在小窗中输入问题并发送
- **则** AI应能够回复用户的问题，支持流式显示
- **且** 回复内容应正确渲染Markdown格式
- **且** 多轮对话应能保持上下文连贯性

### Requirement: 上下文增强对话
系统MUST支持AI利用页面内容提供更精准的对话服务，提供个性化的学习支持。

#### 场景：AI基于页面内容提供精准回答
- **当** 用户询问关于当前笔记内容的问题
- **则** AI应能够基于笔记内容给出准确回答
- **且** AI可以在回答中引用笔记中的具体段落
- **且** AI能够基于笔记内容提供相关的扩展知识

### Requirement: 视觉风格统一
系统MUST确保悬浮对话组件的视觉设计与现有界面保持一致，确保整体设计协调。

#### 场景：悬浮对话组件与主界面的视觉一致性
- **当** 查看悬浮球的样式时
- **则** 悬浮球的颜色和样式应与主界面的主要按钮一致
- **且** 对话小窗的配色方案应使用相同的主题色彩
- **且** 输入框、按钮等组件的样式应与主界面一致

### Requirement: 响应式设计
系统MUST支持悬浮对话组件适配不同屏幕尺寸和设备，确保在各种环境下都有良好的使用体验。

#### 场景：悬浮组件在不同设备上的适配
- **当** 在桌面设备上使用时
- **则** 悬浮球应保持标准大小和位置
- **当** 在移动设备上使用时
- **则** 悬浮球应适当调整大小避免误触
- **且** 对话小窗应自动调整宽度以适应屏幕

### Requirement: 性能优化
系统MUST确保悬浮对话组件高效运行，不影响页面性能，确保用户体验的流畅性。

#### 场景：悬浮组件对页面性能的影响测试
- **当** 页面加载时
- **则** 页面加载时间不应因悬浮组件而显著增加
- **当** 长时间使用对话功能后
- **则** 页面应保持流畅
- **当** 包含大量消息时
- **则** 滚动操作应保持流畅

### Requirement: 功能兼容性
系统MUST确保悬浮对话功能不影响现有功能的正常运行，确保系统稳定性。

#### 场景：悬浮功能与现有功能的兼容性测试
- **当** 打开悬浮对话小窗时
- **则** 不应影响侧边栏的展开收起
- **且** 在编辑笔记时使用悬浮AI功能不应干扰编辑操作
- **且** 现有的快捷键和操作习惯应保持不变

## MODIFIED Requirements

### Requirement: 空间预留
系统MUST为悬浮对话组件预留合适的显示空间，确保界面布局的合理性。

#### 场景：页面布局为悬浮组件预留空间
- **当** 查看页面布局时
- **则** 页面右下角应有足够空间显示悬浮球
- **且** 悬浮小窗打开后不应遮挡重要的页面控制元素
- **且** 页面滚动时悬浮球位置保持固定
- **且** 不同屏幕尺寸下悬浮组件都能正常显示

## REMOVED Requirements

无移除的需求项。